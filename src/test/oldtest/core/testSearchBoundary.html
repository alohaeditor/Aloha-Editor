<html>
  <head>
<!-- IMPORTANT: do not remove the next line, it will include scripts and styles necessary for the test to run -->
<!-- #include file="${com.gentics.labs.browsertest.includedir}/head-include.inc" -->

<!-- #include file="${com.gentics.aloha.src}/test/${com.gentics.aloha.loaderprefix}testloader.html" -->

  <script type="text/javascript">

GENTICS.Aloha.settings = {
	errorhandling : false
};

	// create the testcase
	YAHOO.com.gentics.labs.browsertest.SearchBoundary = new YAHOO.tool.TestCase({

	    //name of the test case - if not provided, one is auto-generated
	    name : "Test Searching Boundaries",

	    /**
	     * Sets the reference text into the p element and initializes some helper objects.
	     */
	    setUp : function () {
	    },

	    /**
	     * Test finding the word boundaries in the first word of a sentence (without wrapping p)
	     */
	    testFirstWordWithoutP : function () {
			var container = $('#content').contents().get(0);
			var offset = 2;

			var leftBoundary = GENTICS.Utils.Dom.searchWordBoundary(container, offset);
			var rightBoundary = GENTICS.Utils.Dom.searchWordBoundary(container, offset, false);

			YAHOO.util.Assert.areEqual(container, leftBoundary.container, 'Check container of left boundary');
			YAHOO.util.Assert.areEqual(0, leftBoundary.offset, 'Check offset of left boundary');
			YAHOO.util.Assert.areEqual(container, rightBoundary.container, 'Check container of right boundary');
			YAHOO.util.Assert.areEqual(4, rightBoundary.offset, 'Check offset of right boundary');
	    },

	    /**
	     * Test finding the word boundaries in a middle word of a sentence (without wrapping p)
	     */
	    testMiddleWordWithoutP : function () {
			var container = $('#content').contents().get(0);
			var offset = 11;

			var leftBoundary = GENTICS.Utils.Dom.searchWordBoundary(container, offset);
			var rightBoundary = GENTICS.Utils.Dom.searchWordBoundary(container, offset, false);

			YAHOO.util.Assert.areEqual(container, leftBoundary.container, 'Check container of left boundary');
			YAHOO.util.Assert.areEqual(8, leftBoundary.offset, 'Check offset of left boundary');
			YAHOO.util.Assert.areEqual(container, rightBoundary.container, 'Check container of right boundary');
			YAHOO.util.Assert.areEqual(14, rightBoundary.offset, 'Check offset of right boundary');
	    },

	    /**
	     * Test finding the word boundaries in the last word of a sentence (without wrapping p)
	     */
	    testLastWordWithoutP : function () {
			var container = $('#content').contents().get(0);
			var offset = 17;

			var leftBoundary = GENTICS.Utils.Dom.searchWordBoundary(container, offset);
			var rightBoundary = GENTICS.Utils.Dom.searchWordBoundary(container, offset, false);

			YAHOO.util.Assert.areEqual(container, leftBoundary.container, 'Check container of left boundary');
			YAHOO.util.Assert.areEqual(15, leftBoundary.offset, 'Check offset of left boundary');
			YAHOO.util.Assert.areEqual(container, rightBoundary.container, 'Check container of right boundary');
			YAHOO.util.Assert.areEqual(19, rightBoundary.offset, 'Check offset of right boundary');
	    },

	    /**
	     * Test finding the word boundaries in the first word of a paragraph
	     */
	    testFirstWordInP : function () {
			var container = $('#content').find('p').eq(0).contents().get(0);
			var offset = 2;

			var leftBoundary = GENTICS.Utils.Dom.searchWordBoundary(container, offset);
			var rightBoundary = GENTICS.Utils.Dom.searchWordBoundary(container, offset, false);

			YAHOO.util.Assert.areEqual(container, leftBoundary.container, 'Check container of left boundary');
			YAHOO.util.Assert.areEqual(0, leftBoundary.offset, 'Check offset of left boundary');
			YAHOO.util.Assert.areEqual(container, rightBoundary.container, 'Check container of right boundary');
			YAHOO.util.Assert.areEqual(4, rightBoundary.offset, 'Check offset of right boundary');
	    },

	    /**
	     * Test finding the word boundaries in a middle word of a paragraph
	     */
	    testMiddleWordInP : function () {
			var container = $('#content').find('p').eq(0).contents().get(0);
			var offset = 11;

			var leftBoundary = GENTICS.Utils.Dom.searchWordBoundary(container, offset);
			var rightBoundary = GENTICS.Utils.Dom.searchWordBoundary(container, offset, false);

			YAHOO.util.Assert.areEqual(container, leftBoundary.container, 'Check container of left boundary');
			YAHOO.util.Assert.areEqual(8, leftBoundary.offset, 'Check offset of left boundary');
			YAHOO.util.Assert.areEqual(container, rightBoundary.container, 'Check container of right boundary');
			YAHOO.util.Assert.areEqual(14, rightBoundary.offset, 'Check offset of right boundary');
	    },

	    /**
	     * Test finding the word boundaries in the last word of a paragraph
	     */
	    testLastWordInP : function () {
			var container = $('#content').find('p').eq(0).contents().get(0);
			var offset = 30;

			var leftBoundary = GENTICS.Utils.Dom.searchWordBoundary(container, offset);
			var rightBoundary = GENTICS.Utils.Dom.searchWordBoundary(container, offset, false);

			YAHOO.util.Assert.areEqual(container, leftBoundary.container, 'Check container of left boundary');
			YAHOO.util.Assert.areEqual(25, leftBoundary.offset, 'Check offset of left boundary');
			YAHOO.util.Assert.areEqual(container, rightBoundary.container, 'Check container of right boundary');
			YAHOO.util.Assert.areEqual(34, rightBoundary.offset, 'Check offset of right boundary');
	    },

	    /*
	     * Test finding the word boundaries starting from the start of a word
	     */
	    testAtStartOfWord : function () {
			var container = $('#content').contents().get(0);
			var offset = 8;

			var leftBoundary = GENTICS.Utils.Dom.searchWordBoundary(container, offset);
			var rightBoundary = GENTICS.Utils.Dom.searchWordBoundary(container, offset, false);

			YAHOO.util.Assert.areEqual(container, leftBoundary.container, 'Check container of left boundary');
			YAHOO.util.Assert.areEqual(8, leftBoundary.offset, 'Check offset of left boundary');
			YAHOO.util.Assert.areEqual(container, rightBoundary.container, 'Check container of right boundary');
			YAHOO.util.Assert.areEqual(14, rightBoundary.offset, 'Check offset of right boundary');
	    },

	    /*
	     * Test finding the word boundaries starting from the end of a word
	     */
	    testAtEndOfWord : function () {
			var container = $('#content').contents().get(0);
			var offset = 14;

			var leftBoundary = GENTICS.Utils.Dom.searchWordBoundary(container, offset);
			var rightBoundary = GENTICS.Utils.Dom.searchWordBoundary(container, offset, false);

			YAHOO.util.Assert.areEqual(container, leftBoundary.container, 'Check container of left boundary');
			YAHOO.util.Assert.areEqual(8, leftBoundary.offset, 'Check offset of left boundary');
			YAHOO.util.Assert.areEqual(container, rightBoundary.container, 'Check container of right boundary');
			YAHOO.util.Assert.areEqual(14, rightBoundary.offset, 'Check offset of right boundary');
	    },

	    testInBold : function () {
			var container = $('#content').find('b').eq(0).contents().get(0);
			var offset = 2;

			var leftBoundary = GENTICS.Utils.Dom.searchWordBoundary(container, offset);
			var rightBoundary = GENTICS.Utils.Dom.searchWordBoundary(container, offset, false);

			YAHOO.util.Assert.areEqual($('#content').find('p').eq(1).contents().get(0), leftBoundary.container, 'Check container of left boundary');
			YAHOO.util.Assert.areEqual(24, leftBoundary.offset, 'Check offset of left boundary');
			YAHOO.util.Assert.areEqual($('#content').find('p').eq(1).contents().get(2), rightBoundary.container, 'Check container of right boundary');
			YAHOO.util.Assert.areEqual(0, rightBoundary.offset, 'Check offset of right boundary');
	    },

	    testAdjacentMarkup : function () {
			var container = $('#content').find('p').eq(2).find('i').eq(0).contents().get(0)
			var offset = 3;

			var leftBoundary = GENTICS.Utils.Dom.searchWordBoundary(container, offset);
			var rightBoundary = GENTICS.Utils.Dom.searchWordBoundary(container, offset, false);

			YAHOO.util.Assert.areEqual($('#content').find('p').eq(2).contents().get(0), leftBoundary.container, 'Check container of left boundary');
			YAHOO.util.Assert.areEqual(36, leftBoundary.offset, 'Check offset of left boundary');
			YAHOO.util.Assert.areEqual($('#content').find('p').eq(2).contents().get(4), rightBoundary.container, 'Check container of right boundary');
			YAHOO.util.Assert.areEqual(6, rightBoundary.offset, 'Check offset of right boundary');
	    }
	});

	$(document).ready(function() {
		$('#content').GENTICS_aloha();
		GENTICS.Aloha.editables[0].activate();
	});

	// add our testcase
	YAHOO.com.gentics.labs.browsertest.Suite.add(YAHOO.com.gentics.labs.browsertest.SearchBoundary);
</script>
  </head>
  <body class="yui-skin-sam" style="margin-top:30px;">
  	<pre id="pre1"></pre><br />
  	<pre id="pre2"></pre>

  	<!-- content -->
<div id="content" style="margin:20px; border:1px solid #000000;">This is normal text.<p>This is normal text in a paragraph.</p><p>There are some words in <b>bold</b>, <i>italic</i> and <b><i>bold and italic</i></b>.</p><p>And here are some adjacent words in normal<b>bold</b><i>italic</i><b>bold</b>normal</p></div>

<!-- IMPORTANT: do not remove the next line, it will include html fragments necessary for the test to run -->
<!-- #include file="${com.gentics.labs.browsertest.includedir}/body-include.inc" -->
  </body>
</html>
